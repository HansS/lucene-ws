<html>
<head>
  <title>Using the Lucene Web Service</title>
  <style type="text/css">
      body {margin: 5%; font-family: Verdana, Arial, Helvetica; }
      p,ul,ol,td {font-size: 12pt}
      h1 {font-size: 18pt; font-weight: bold;}
      h2 {font-size: 16pt; font-weight: bold; background-color: #ddddFF; padding: 2px; margin-top: 2em;}
      h3 {font-size: 14pt; font-weight: bold; background-color: #FFdddd; padding: 2px; margin-top: 2em;}
      a {color: #3300FF; text-decoration: none}
      a:hover {text-decoration: underline}
      pre {background-color: #dddddd; padding: .5em; margin: .5em;}
      .element {font-family: Courier-new, Courier; font-weight: bold;}
  </style>
</head>
<body>
<h1>Lucene Web Service Documentation</h1>
<h2>Lucene Resources</h2>

<p>
Here are some useful Lucene resources:
</p>

<ul>
<li><a href="http://jakarta.apache.org/lucene/docs/index.html">Documentation</a>
<li><a href="http://www.darksleep.com/lucene/">Tutorial</a>
<li><a href="http://www.onjava.com/pub/a/onjava/2003/01/15/lucene.html">Introduction to Text Indexing with Apache Jakarta Lucene </a>
<li><a href="http://www.onjava.com/pub/a/onjava/2003/03/05/lucene.html">Advanced Text Indexing with Lucene</a>
</ul>

<p>
The rest of this document assumes that you have read the docs on how to use Lucene.
</p>

<h2>Creating a Lucene Index</h2>

<p>
There are three ways to create a Lucene index for use in this web service:
</p>

<ol>
<li>
Create the index on the fly by sending one or more documents to the <b>documentindexer</b> resource.
See below for more details. Please note that this approach for creating and indexing documents is <b>NOT</b>
recommended due to the extra overhead created by the web service. If you're going to index a body
of documents, you should do it with using one the approaches below.
</li>
<li>
If you're going to create a lucene index from an SQL database, you should use the CreateIndex.java
program in the utils directory of the source distribution. Please read the comments in the code
for how to use that script.
<li>
Use Lucene directly from your program to create the index and then have the web service provide access
to the index.
</li>
</ol>


<h2>Using the Lucene Web Service</h2>

<p>
The Lucene Web Service implements a set of <a href="http://webservices.xml.com/pub/a/ws/2002/07/10/rest.html">REST</a> resources that give
web enabled access to creating and searching Lucene text indexes. This web service receives XML documents
via HTTP POST commands and returns XML documents on HTTP GET commands. Any command that has a side-effect
(read: it modifies the index) is done via a POST command -- all others are implemented using GET.
</p>

<p>
The following resources are supported by the Luence Web Service:
</p>

<h3>Searching (resource searchresult)</h3>

<p>GET URL: <b>/lucene/[index name]/searchresult?maxhits=[max hits]&defaultfield=[default field]&query=[query]</b></p>

<p>
This resource peforms a Lucene search and returns the search results.
</p>

<p>
Arguments:
<ul>
<li><b>[index name]</b> -- The name of the index to search -- must be the name of an existing index.
<li><b>[max hits]</b> -- The maximum number of search hits to return.
<li><b>[defaultfield]</b> -- The default field to use while searching this index. Please see the 
                             Lucene resouces/documention on the meaning of this field.
<li><b>[query]</b> -- The Lucene query string. For details on this query string, please see the
                        <a href="http://jakarta.apache.org/lucene/docs/queryparsersyntax.html">Lucene 
                        Query Syntax</a>.
</ul>

<p>
This performs a Lucene search on the given index. The XML returned will look something like this:
</p>

<pre>
&lt;?xml version="1.0"?&gt;
&lt;searchresults&gt;
  &lt;index&gt;track&lt;/index&gt;
  &lt;hits total="787"&gt;1&lt;/hits&gt;
  &lt;searchresult&gt;
    &lt;document&gt;
      &lt;score&gt;100&lt;/score&gt;
      &lt;field name="artistId"&gt;8f6bd1e4-fbe1-4f50-aa9b-94c450ec0f11&lt;/field&gt;
      &lt;field name="artist"&gt;Portishead&lt;/field&gt;
      &lt;field name="albumId"&gt;8f468f36-8c7e-4fc1-9166-50664d267127&lt;/field&gt;
      &lt;field name="album"&gt;Dummy&lt;/field&gt;
    &lt;/document&gt;
  &lt;/searchresult&gt;
&lt;/searchresults&gt;
</pre>

<p>
The <span class="element">index</span> element gives the name of the index this search was performed on. 
The <span class="element">hits</span> element shows how many hits were returned, and the 
<span class="element">total</span> attribute on the <span class="element">hits</span> element shows how 
many matches were found for this search. The <span class="element">searchresult</span> element can have 
one or more document elements, and the <span class="element">document</span> element gives information for 
a specifc document that matched the search.
</p>

<p>
For each <span class="element">document</span> element, there will be a <span class="element">score</span> element that gives the score for this match from
0 - 100. This is followed by one or more <span class="element">field</span> elements that gives the name for the field 
in the <span class="element">name</span> attribute.
</p>

<h3>Indexing documents (resource documentindexer)</h3>

<p>POST URL: <b>/lucene/[index name]/documentindexer</b></p>

<p>
To add a document to an index POST the document to the URL above. If the index does not exist, it will be
created.
</p>
<p>
Arguments:
<ul>
<li><b>[index name]</b> -- The name of the index to add this document to -- must be a valid directory name.
</ul>

<p>
The document POSTed to the URL must be formatted like this:
</p>

<pre>
&lt;xml version="1.0"?&gt;
&lt;documents analyzer="WithStopAnalyzer"&gt;
    &lt;document&gt;
       &lt;field name="artist"&gt;U2&lt;/field&gt;
       &lt;field name="album"&gt;October&lt;/field&gt;
       &lt;field name="track"&gt;Gloria&lt;/field&gt;
    &lt;/document&gt;
&lt;/documents&gt;
</pre>

<p>
For the very first document indexed, the <span class="element">documents</span> element should have the 
<span class="element">analyzer</span> attribute defined. 
This defines the type of analyzer to use for this index. Once the index has been created, all subsequent
calls to <b>documenanalyzer</b> will ignore the <span class="element">analyzer</span> attribute. For more
info on analyzers, please refer to the Lucene documentation. The following values for the 
<span class="element">analyzer</span> attribute are valid:
</p>

<ul>
<li>SimpleAnalyzer - Simply lowercases all of the input.
<li>StopAnalyzer - Lowercases the input and removes stop words.
<li>StandardAnalyzer - Lowercases the input, removes stop words and removes some punctuation.
<li>WithStopAnalyzer - Just like StandardAnalyzer, but it does not remove stop words.
</ul>

<p>
The <span class="element">document</span> element follows the same form as descibed in the searching section.
</p>

<h3>Updating documents (resource documentupdater)</h3>

<p>POST URL: <b>/lucene/[index name]/documentupdater</b></p>

<p>
This service removes one or more documents from the index and re-adds one or more documents in one operation.
</p>

<pre>
&lt;?xml version="1.0"?&gt;
&lt;documents&gt;
    &lt;document&gt;
       &lt;removequery defaultfield="album"&gt;artist:portishead dummies&lt;/removequery&gt;
       &lt;field name="artist"&gt;Portishead&lt;/field&gt;
       &lt;field name="album"&gt;Dummy&lt;/field&gt;
    &lt;/document&gt;
&lt;/documents&gt;
</pre>

<p>
This document is structured like the <b>documentindexer</b> XML, but it adds the new 
<span class="element">removequery</span> element that specifies what documents to remove before 
adding the new document. The <span class="element">removequery</span> element has a 
<span class="element">defaultfield</span> attribute that specifies the default field to 
use for the query. For more details on this field, please see the <b>searchresult</b> query.
</p>

<p>
Once the documents specified by <span class="element">removequery</span> have been removed, the document specified below will be added to the index. This <b>documentupdater</b> query can also handle multiple <span class="element">document</span> elements inside the <span class="element">documents</span> element.
</p>

<h3>Removing Documents (resource documentremover)</h3>

<p>POST URL: <b>/lucene/[index name]/documentremover</b></p>

<p>
Use the <b>documentremover</b> resource to remove a document from an index. The XML format used
for this query is almost the same as the one used for <b>documentupdater</b>:
</p>

<pre>
&lt;?xml version="1.0"?&gt;
&lt;documents&gt;
    &lt;document&gt;
       &lt;removequery defaultfield="album"&gt;artist:portishead dummies&lt;/removequery&gt;
    &lt;/document&gt;
&lt;/documents&gt;
</pre>

<p>
In this case, the XML has no <span class="element">field</span> elements, unlike the <b>documentremover</b>
resource.
</p>

<h3>Optimizing an Index (resource optimizer)</h3>

<p>POST URL: <b>/lucene/[index name]/optimizer</b></p>

<p>
To optimize a Lucene index after altering an index, POST an empty document to the URL above. The
contents of the POST are ignored.
</p>
