<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd">
<beans>

	<bean class="org.springframework.web.context.support.ServletContextPropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>WEB-INF/lucene-servlet.properties</value>
				<value>WEB-INF/lucene-servlet-local.properties</value>
			</list>
		</property>
		<property name="contextOverride" value="true" /> <!-- Servlet context properties take precedence -->
	</bean>

	<bean id="service" class="net.lucenews3.DefaultService">
		<property name="indexRepository" ref="indexRepository" />
		<property name="indexAttributeName" value="${indexAttributeName}" />
	</bean>

	<bean id="indexRepository" class="net.lucenews3.FileSystemIndexRepository">
		<property name="directory" value="${indexesDirectory}" />
	</bean>

	<bean id="atomDateFormat" class="net.lucenews3.AtomDateFormat" factory-method="getInstance" />



	<!-- Controllers -->

	<bean id="controller" abstract="true">
		<property name="service" ref="service" />
	</bean>

	<bean id="getServiceController" class="net.lucenews3.controller.ServiceGetController" parent="controller" />

	<bean id="createIndexController" class="net.lucenews3.controller.IndexCreateController" parent="controller" />

	<bean id="getIndexPropertiesController" class="net.lucenews3.controller.IndexPropertiesGetController" parent="controller" />

	<bean id="getServicePropertiesController" class="net.lucenews3.controller.ServicePropertiesGetController" parent="controller" />

	<bean id="searchIndexController" class="net.lucenews3.controller.IndexSearchController" parent="controller">
		<property name="searchTermsParameterName" value="${searchTermsParameterName}" />
		<property name="countParameterName"       value="${countParameterName}" />
		<property name="startIndexParameterName"  value="${startIndexParameterName}" />
		<property name="startPageParameterName"   value="${startIndexParameterName}" />
	</bean>

	<bean id="createDocumentController" class="net.lucenews3.controller.DocumentCreateController" parent="controller" />

	<bean id="getDocumentController" class="net.lucenews3.controller.DocumentGetController" parent="controller">
		<property name="documentAttributeName" value="${documentAttributeName}" />
	</bean>
	
	<bean id="openSearchDescriptionController" class="net.lucenews3.controller.OpenSearchDescriptionController" parent="controller" />



	<!-- Handler mappings -->

	<bean id="serviceHandlerMapping" class="net.lucenews3.RequestMethodHandlerMapping">
		<property name="getHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="getServiceController" />
			</bean>
		</property>
		<property name="postHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="createIndexController" />
			</bean>
		</property>
		<!--
		<property name="putHandlerMapping"    ref="" />
		<property name="deleteHandlerMapping" ref="" />
		-->
	</bean>

	<bean id="servicePropertiesHandlerMapping" class="net.lucenews3.RequestMethodHandlerMapping">
		<property name="getHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="getServicePropertiesController" />
			</bean>
		</property>
		<!--
		<property name="postHandlerMapping"   ref="" />
		<property name="putHandlerMapping"    ref="" />
		<property name="deleteHandlerMapping" ref="" />
		-->
	</bean>

	<bean id="indexHandlerMapping" class="net.lucenews3.RequestMethodHandlerMapping">
		<property name="getHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="searchIndexController" />
			</bean>
		</property>
		<property name="postHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="createDocumentController" />
			</bean>
		</property>
		<!--
		<property name="putHandlerMapping"    ref="" />
		<property name="deleteHandlerMapping" ref="" />
		-->
	</bean>

	<bean id="indexPropertiesHandlerMapping" class="net.lucenews3.RequestMethodHandlerMapping">
		<property name="getHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="getIndexPropertiesController" />
			</bean>
		</property>
		<!--
		<property name="postHandlerMapping"   ref="" />
		<property name="putHandlerMapping"    ref="" />
		<property name="deleteHandlerMapping" ref="" />
		-->
	</bean>

	<bean id="documentHandlerMapping" class="net.lucenews3.RequestMethodHandlerMapping">
		<property name="getHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="getDocumentController" />
			</bean>
		</property>
		<!--
		<property name="postHandlerMapping"   ref="" />
		<property name="putHandlerMapping"    ref="" />
		<property name="deleteHandlerMapping" ref="" />
		-->
	</bean>

	<bean id="openSearchDescriptionHandlerMapping" class="net.lucenews3.RequestMethodHandlerMapping">
		<property name="getHandlerMapping">
			<bean class="net.lucenews3.ControllerHandlerMapping">
				<property name="controller" ref="openSearchDescriptionController" />
			</bean>
		</property>
	</bean>

	<bean id="handlerMapping" class="net.lucenews3.ResourceHandlerMapping">
		<property name="serviceHandlerMapping"               ref="serviceHandlerMapping" />
		<property name="servicePropertiesHandlerMapping"     ref="servicePropertiesHandlerMapping" />
		<property name="indexHandlerMapping"                 ref="indexHandlerMapping" />
		<property name="indexPropertiesHandlerMapping"       ref="indexPropertiesHandlerMapping" />
		<property name="documentHandlerMapping"              ref="documentHandlerMapping" />
		<property name="openSearchDescriptionHandlerMapping" ref="openSearchDescriptionHandlerMapping" />
		<property name="indexAttributeName"                  value="${indexAttributeName}" />
		<property name="documentAttributeName"               value="${documentAttributeName}" />
	</bean>



	<bean class="net.lucenews3.DefaultHandlerExceptionResolver" />

	<!-- Views -->

	<bean id="view" abstract="true" />

	<bean id="xmlView" abstract="true" parent="view" />

	<bean id="introspectionView" class="net.lucenews3.view.APPIntrospectionView" parent="view">
		<property name="service" ref="service" />
	</bean>

	<bean id="openSearchDescriptionView" class="net.lucenews3.OpenSearchDescriptionView" parent="view">
		<property name="searchTermsParameterName" value="${searchTermsParameterName}" />
		<property name="countParameterName"       value="${countParameterName}" />
		<property name="startIndexParameterName"  value="${startIndexParameterName}" />
		<property name="startPageParameterName"   value="${startPageParameterName}" />
		<property name="service" ref="service" />
	</bean>

	<bean id="openSearchResponseView" class="net.lucenews3.view.OpenSearchResponseView" parent="view">
		<property name="service" ref="service" />
		<property name="atomDateFormat" ref="atomDateFormat" />
	</bean>

	<bean id="documentView" class="net.lucenews3.view.DocumentXMLView" parent="view" />

	<bean id="propertiesView" class="net.lucenews3.view.PropertiesXMLView" parent="xmlView" />

	<bean id="exceptionView" class="net.lucenews3.view.ExceptionView" parent="xmlView" />

	<bean id="viewResolver" class="net.lucenews3.view.MappedViewResolver">
		<property name="viewsByName">
			<map>
				<entry key="service/get"            value-ref="introspectionView" />
				<entry key="search/results"         value-ref="openSearchResponseView" />
				<entry key="document/get"           value-ref="documentView" />
				<entry key="serviceProperties/get"  value-ref="propertiesView" />
				<entry key="indexProperties/get"    value-ref="propertiesView" />
				<entry key="error"                  value-ref="exceptionView" />
				<entry key="openSearch/description" value-ref="openSearchDescriptionView" />
			</map>
		</property>
	</bean>

</beans>